<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Karten</title>
    <style>
      :root { color-scheme: light dark; }
      body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Ubuntu, Cantarell, Helvetica Neue, Arial, "Apple Color Emoji","Segoe UI Emoji"; margin: 0; padding: 24px; }
      a { color: #4f46e5; text-decoration: none; }
      h1 { font-size: 2.25rem; font-weight: 800; margin: 0 0 24px 0; }
      .muted { color: #6b7280; }
      .error { color: #dc2626; font-weight: 600; }
      .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; margin-top: 16px; }
      .card { border: 1px solid rgba(0,0,0,.1); border-radius: 12px; padding: 16px; background: rgba(255,255,255,.6); backdrop-filter: blur(4px); }
      .card h2 { font-size: 1.5rem; margin: 0 0 8px 0; }
      .row { margin: 6px 0; }
      .label { color: #6b7280; width: 110px; display: inline-block; }
      .src { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; }
    </style>
  </head>
  <body>
    <p><a href="./index.html">← Start</a></p>
    <h1>Karten</h1>
    <p class="muted">Quelle: <span class="src">docs/api/mocks/cards_page_1.json</span></p>

    <div id="list" class="grid"></div>
    <div id="err" class="error" style="display:none;">Fehler beim Laden.</div>

    <script>
      (async function loadList() {
        const $list = document.getElementById('list');
        const $err = document.getElementById('err');

        function fail(msg) {
          $err.style.display = 'block';
          if (msg) $err.textContent = msg;
        }

        try {
          // Cache-Busting via Zeitstempel
          const url = `./docs/api/mocks/cards_page_1.json?cb=${Date.now()}`;
          const res = await fetch(url, { cache: 'no-store' });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);

          const data = await res.json();

          // Unterstütze verschiedene Strukturen
          const list = Array.isArray(data)
            ? data
            : Array.isArray(data.cards)
              ? data.cards
              : Array.isArray(data.items)
                ? data.items
                : [];

          if (!list.length) {
            fail('Keine Karten gefunden.');
            return;
          }

          const frag = document.createDocumentFragment();

          list.forEach(item => {
            const id = (item && item.id) ? String(item.id).trim() : '';
            const name = item.name || item.title || 'Unbekannt';
            const club = item.team || item.club || item.teamName || '—';
            const variant = item.variant || item.variante || '—';
            const rarity = item.rarity || item.seltenheit || '—';

            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
              <h2><a href="./detail.html?id=${encodeURIComponent(id)}">${name}</a></h2>
              <div class="row"><span class="label">Club:</span> ${club}</div>
              <div class="row"><span class="label">ID:</span> ${id || '—'}</div>
              <div class="row"><span class="label">Variante:</span> ${variant}</div>
              <div class="row"><span class="label">Seltenheit:</span> ${rarity}</div>
            `;
            frag.appendChild(div);
          });

          $list.innerHTML = '';
          $list.appendChild(frag);
        } catch (e) {
          console.error(e);
          fail('Fehler beim Laden.');
        }
      })();
    </script>
  </body>
</html>
